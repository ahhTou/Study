# Jwt

JSON WEB令牌

- 无状态
- 放入http 中 的 header



jwt的结构

token string ------- header.payload.singnature

- 标头（header）

    使用Base64编码

    ```json
    {
    	"alg": "HS256",
        "typ": "JWT"
    }
    ```

- 有效载荷 (Payload)

    使用Base64编码

    ```json
    {
        "username": "ahhTou",
       	"admin": true
    }
    ```

- 签名 (Signature)

    加密算法

# 生成Token

```java
Calendar instance = Calendar.getInstance();
instance.add(Calendar.DATE, expireMin); // 过期时间


return JWT.create()
        .withClaim("username", username)
        .withExpiresAt(instance.getTime()) // 过期时间
        .sign(Algorithm.HMAC256(SECRET));
```



# 解码

解码失败会报错

```java
try {
    return JWT.require(Algorithm.HMAC256("I am secret")).build().verify(token);
} catch (Exception e) {
    return null;
}
```

# 几种异常

- Token过期：TokenExpireException
- 无效签名： SignatureVerificationException
- 算法不一致失败： AlgorithmMismatchExcetion
- 错误编码： JWTDecodeException





# 关闭session

```java
// 创建安全管理器
@Bean("sm")
public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier("MyRealm") Realm realm) {
    DefaultWebSecurityManager manager = new DefaultWebSecurityManager();
    // 关闭shiro自带的session，详情见文档
    DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO();
    DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = new DefaultSessionStorageEvaluator();
    defaultSessionStorageEvaluator.setSessionStorageEnabled(false);
    manager.setSubjectDAO(subjectDAO);
    manager.setRealm(realm);
    return manager;
}
```